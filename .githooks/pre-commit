#!/usr/bin/env bash
set -euo pipefail



staged_kotlin_files=()
while IFS= read -r -d '' file; do
  staged_kotlin_files+=("$file")
done < <(git diff --cached --name-only --diff-filter=ACMR -z -- '*.kt' '*.kts')

if [ ${#staged_kotlin_files[@]} -eq 0 ]; then
  exit 0
fi

echo "pre-commit: running ./gradlew ktlintFormat on staged Kotlin files..."
./gradlew ktlintFormat -Pktlint.filter="${staged_kotlin_files[*]}"

# Re-stage files that were modified by formatter.
git add -- "${staged_kotlin_files[@]}"

